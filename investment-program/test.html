<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆ¬ì ë³´ì¡° í”„ë¡œê·¸ë¨ - ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            background: white;
            border-left: 4px solid #3498db;
        }
        .error {
            border-left-color: #e74c3c;
            background: #fdf2f2;
        }
        .success {
            border-left-color: #27ae60;
            background: #f2fdf2;
        }
        .loading {
            color: #f39c12;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª íˆ¬ì ë³´ì¡° í”„ë¡œê·¸ë¨ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h3>1. API ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testApiConnection()">API ì—°ê²° í™•ì¸</button>
            <div id="api-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>2. ë‹¨ì¼ ì¢…ëª© ë¶„ì„ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testSingleStock('NVDA')">NVDA ë¶„ì„</button>
            <button class="test-button" onclick="testSingleStock('AAPL')">AAPL ë¶„ì„</button>
            <button class="test-button" onclick="testSingleStock('TSLA')">TSLA ë¶„ì„</button>
            <div id="single-stock-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>3. ì›”ë³„ ì¶”ì²œ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testMonthlyRecommendations('ai')">AI ì¢…ëª© ì¶”ì²œ</button>
            <button class="test-button" onclick="testMonthlyRecommendations('semiconductor')">ë°˜ë„ì²´ ì¶”ì²œ</button>
            <button class="test-button" onclick="testMonthlyRecommendations('popular')">ì¸ê¸° ì¢…ëª© ì¶”ì²œ</button>
            <div id="monthly-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>4. ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testErrorHandling()">ì˜ëª»ëœ ì¢…ëª© í…ŒìŠ¤íŠ¸</button>
            <div id="error-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>5. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="performanceTest()">ë‹¤ì¤‘ ì¢…ëª© ë™ì‹œ ë¶„ì„</button>
            <div id="performance-result" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        // API ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testApiConnection() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="loading">API ì—°ê²°ì„ í™•ì¸í•˜ëŠ” ì¤‘...</span>';
            
            try {
                const endpoints = [
                    '/api/quote/AAPL',
                    '/api/analysis/AAPL', 
                    '/api/score/AAPL',
                    '/api/recommendations/monthly?category=popular'
                ];
                
                const results = await Promise.all(
                    endpoints.map(async (endpoint) => {
                        const response = await fetch(endpoint);
                        return {
                            endpoint,
                            status: response.status,
                            ok: response.ok
                        };
                    })
                );
                
                let html = '<div class="success">âœ… API ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ë£Œ</div><pre>';
                results.forEach(result => {
                    html += `${result.endpoint}: ${result.ok ? 'âœ… OK' : 'âŒ FAIL'} (${result.status})\\n`;
                });
                html += '</pre>';
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ API ì—°ê²° ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // ë‹¨ì¼ ì¢…ëª© ë¶„ì„ í…ŒìŠ¤íŠ¸
        async function testSingleStock(ticker) {
            const resultDiv = document.getElementById('single-stock-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<span class="loading">${ticker} ë¶„ì„ ì¤‘...</span>`;
            
            try {
                const [quoteRes, analysisRes, scoreRes] = await Promise.all([
                    fetch(`/api/quote/${ticker}`),
                    fetch(`/api/analysis/${ticker}`),
                    fetch(`/api/score/${ticker}`)
                ]);
                
                const [quote, analysis, score] = await Promise.all([
                    quoteRes.json(),
                    analysisRes.json(),
                    scoreRes.json()
                ]);
                
                let html = `<div class="success">âœ… ${ticker} ë¶„ì„ ì™„ë£Œ</div><pre>`;
                html += `í˜„ì¬ê°€: $${quote.currentPrice || 'N/A'}\\n`;
                html += `ë³€ë™ë¥ : ${quote.changePercent || 'N/A'}%\\n`;
                html += `ë§¤ë§¤ì‹ í˜¸: ${analysis.signal || 'N/A'}\\n`;
                html += `RSI: ${analysis.rsi || 'N/A'}\\n`;
                html += `ì¢…í•©ì ìˆ˜: ${score.totalScore ? (score.totalScore * 100).toFixed(0) : 'N/A'}/100\\n`;
                html += `ì¶”ì²œ: ${score.recommendation || 'N/A'}\\n`;
                html += '</pre>';
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ${ticker} ë¶„ì„ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // ì›”ë³„ ì¶”ì²œ í…ŒìŠ¤íŠ¸
        async function testMonthlyRecommendations(category) {
            const resultDiv = document.getElementById('monthly-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<span class="loading">${category} ì¹´í…Œê³ ë¦¬ ì¶”ì²œ ìƒì„± ì¤‘...</span>`;
            
            try {
                const response = await fetch(`/api/recommendations/monthly?category=${category}`);
                const data = await response.json();
                
                let html = `<div class="success">âœ… ${data.month} ${category} ì¶”ì²œ ì™„ë£Œ</div><pre>`;
                html += `ë¶„ì„ëœ ì¢…ëª© ìˆ˜: ${data.totalAnalyzed}\\n`;
                html += `ì¶”ì²œ ì¢…ëª©:\\n`;
                
                data.recommendations.forEach((stock, index) => {
                    html += `${index + 1}. ${stock.ticker} - ${(stock.totalScore * 100).toFixed(0)}ì  (${stock.recommendation})\\n`;
                });
                
                html += '</pre>';
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ì¶”ì²œ ìƒì„± ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
        async function testErrorHandling() {
            const resultDiv = document.getElementById('error-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="loading">ì˜¤ë¥˜ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì¤‘...</span>';
            
            try {
                // ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¢…ëª©ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
                const response = await fetch('/api/score/INVALID_TICKER');
                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = '<div class="success">âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ì •ìƒ ì‘ë™</div><pre>ì˜ëª»ëœ ì¢…ëª©ì— ëŒ€í•´ ì ì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ ë°˜í™˜</pre>';
                } else {
                    resultDiv.innerHTML = '<div class="error">âš ï¸ ì˜¤ë¥˜ ì²˜ë¦¬ í™•ì¸ í•„ìš”</div>';
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="success">âœ… ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬ ì •ìƒ</div><pre>ì˜ˆìƒëœ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}</pre>`;
            }
        }

        // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        async function performanceTest() {
            const resultDiv = document.getElementById('performance-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<span class="loading">ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì¤‘... (ì•½ 30ì´ˆ ì†Œìš”)</span>';
            
            const startTime = Date.now();
            const tickers = ['NVDA', 'AAPL', 'MSFT', 'GOOG', 'TSLA'];
            
            try {
                const promises = tickers.map(ticker => 
                    fetch(`/api/score/${ticker}`).then(res => res.json())
                );
                
                const results = await Promise.all(promises);
                const endTime = Date.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);
                
                let html = `<div class="success">âœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ</div><pre>`;
                html += `ì‹¤í–‰ ì‹œê°„: ${duration}ì´ˆ\\n`;
                html += `ì„±ê³µí•œ ë¶„ì„: ${results.filter(r => !r.error).length}/${tickers.length}\\n`;
                html += `í‰ê·  ì‘ë‹µ ì‹œê°„: ${(duration / tickers.length).toFixed(2)}ì´ˆ/ì¢…ëª©\\n`;
                html += '</pre>';
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ API ì—°ê²° í…ŒìŠ¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª íˆ¬ì ë³´ì¡° í”„ë¡œê·¸ë¨ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            setTimeout(testApiConnection, 1000);
        });
    </script>
</body>
</html>